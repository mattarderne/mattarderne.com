<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><title>Modelling hydrological networks at massive scale - Matt Arderne</title><meta name="description" content="Ironically, a large part of my work at KTH’s Division of Energy Systems Analysis was modelling complex hydrological systems. I set out to create a model that would conduct massive scale hydrological modelling."><meta property="og:type" content="article"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="Matt Arderne"><meta property="og:title" content="Modelling hydrological networks at massive scale"><meta property="og:url" content="http://localhost:4000/modelling-hydrological-networks/"><meta property="og:description" content="Ironically, a large part of my work at KTH’s Division of Energy Systems Analysis was modelling complex hydrological systems. I set out to create a model that would conduct massive scale hydrological modelling."><meta property="article:published_time" content="2017-04-15T13:26:00+01:00"><link rel="canonical" href="http://localhost:4000/modelling-hydrological-networks/"><link rel="alternate" href="http://localhost:4000/modelling-hydrological-networks/feed.xml" type="application/rss+xml" title="Chris Arderne"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style> *{box-sizing:border-box}html{box-sizing:border-box;background-color:#fff;font-size:16px;margin-left:calc(100vw - 100%);-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;position:relative;min-height:100%}@media (min-width: 768px){html{font-size:18px}}@media (min-width: 1024px){html{font-size:20px}}@media (min-width: 1500px){html{font-size:22px}}body{margin:0;padding:0;color:#494e52;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif;line-height:1.5}::-moz-selection{color:#fff;background:#000}::selection{color:#fff;background:#000}audio:not([controls]){display:none}a{color:#32859e;text-decoration:none;color:#458CD5}a:hover,a:active{outline:0}a:hover{text-decoration:underline}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{max-width:100%;width:auto\9;height:auto;vertical-align:middle;border:0;-ms-interpolation-mode:bicubic}h1,h2,h3,h4,h5,h6{margin:2em 0 0.5em;line-height:1.2;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif;font-weight:bold}h1{margin-top:0;font-size:1.563em}h2{font-size:1.25em}h3{font-size:1em}h4{font-size:.75em}h5{font-size:.75em}h6{font-size:.75em}small{font-size:.75em}p{margin-bottom:1.3em}u,ins{text-decoration:none;border-bottom:1px solid #494e52}u a,ins a{color:inherit}del a{color:inherit}p,pre,blockquote,ul,ol,dl,figure,table,fieldset{orphans:3;widows:3}blockquote{margin:2em 1em 2em 0;padding-left:1em;padding-right:1em;font-style:italic;border-left:0.25em solid #6f777d}blockquote cite{font-style:italic}blockquote cite:before{content:"\2014";padding-right:5px}a:visited{color:#5197ad}a:hover{color:#266477;outline:0}tt,code,kbd,samp,pre{font-family:Monaco,Consolas,"Lucida Console",monospace}pre{overflow-x:auto}p>code,a>code,li>code,figcaption>code,td>code{padding-top:0.1rem;padding-bottom:0.1rem;font-size:0.8em;background:#fafafa;border-radius:4px}p>code:before,p>code:after,a>code:before,a>code:after,li>code:before,li>code:after,figcaption>code:before,figcaption>code:after,td>code:before,td>code:after{letter-spacing:-0.2em;content:"\00a0"}hr{display:block;margin:1em 0;border:0;border-top:1px solid #f2f3f3}ul li,ol li{margin-bottom:0.5em}li ul,li ol{margin-top:0.5em}figure{display:-webkit-box;display:flex;-webkit-box-pack:justify;justify-content:space-between;-webkit-box-align:start;align-items:flex-start;flex-wrap:wrap;margin:2em 0}figure img,figure iframe{margin-bottom:1em}figure img{width:100%;border-radius:4px;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out}figure>a{display:block}figcaption{margin-bottom:0.5em;color:#898c8f;font-family:Georgia,Times,serif;font-size:.75em}figcaption a{-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out}figcaption a:hover{color:#266477}.main{clear:both;max-width:100%;margin-left:auto;margin-right:auto;padding-left:0.3em;padding-right:0.3em;padding-bottom:0.4em}.main::after{clear:both;content:"";display:table}@media (min-width: 1024px){.main{padding-left:1em;padding-right:1em;margin-top:2em;margin-left:calc(0.2 * 330px)}}@media (min-width: 1500px){.main{margin-left:calc(50% - 900px/2 - 330px)}}.body{float:left;margin-top:1em;width:100%}@media (min-width: 1024px){.body{margin-top:0;width:calc(100% - 330px);max-width:900px}}.archive-item{position:relative}.archive-item-date{color:#888;font-size:.75em}.archive-item-title a{color:#3a4549;margin-bottom:0.25em;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif;line-height:initial;overflow:hidden;text-overflow:ellipsis}.archive-item-title a a::before{content:'';position:absolute;left:0;top:0;right:0;bottom:0}.archive-item-title a a+a{opacity:0.5}.archive-item-excerp{margin-top:0;font-size:.75em}.archive-item-excerp+p{text-indent:0}.archive-item-excerp a{position:relative}.page-title{margin-top:0.3em;line-height:1;font-size:1.953em}.page-date{color:#888}.taglist a{background-color:#ccc;color:#fff;display:inline-block;line-height:1.5em;margin-left:2em;padding:0.3em 0.6em 0.3em 0.6em;vertical-align:20%;font-size:0.5em;font-family:"Open Sans", sans-serif;font-weight:700 !important;text-transform:uppercase;letter-spacing:0.05em;border-radius:0.25em;-moz-border-radius:0.25em;-webkit-border-radius:0.25em}.page-content{position:relative;float:left;margin-left:0;margin-right:0;width:100%;clear:both}.page-content h2{padding-bottom:0.5em;border-bottom:1px solid #f2f3f3}.page-content p,.page-content li,.page-content dl{font-size:1em}.page-content p{margin:0 0 1.3em}.page-content a:not(.btn):hover{text-decoration:underline}.page-content a:not(.btn):hover img{box-shadow:0 0 10px rgba(0,0,0,0.25)}.page-content dt{margin-top:1em;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif;font-weight:bold}.page-content dd{margin-left:1em;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif;font-size:.75em}.page-content .small{font-size:.75em}.page-content blockquote+.small{margin-top:-1.5em;padding-left:1.25rem}.books>div{grid-template-columns:1fr .75fr 70px;display:grid;grid-column-gap:5px;padding-top:5px}@media (min-width: 768px){.books>div{grid-template-columns:1fr .75fr min-content 70px}}.books>div div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.books>div div:nth-child(3){display:none}@media (min-width: 768px){.books>div div:nth-child(3){display:block;padding-right:.25em;color:#888;font-size:90%;padding-top:1px;font-variant-numeric:tabular-nums;letter-spacing:-.012em}}.star{width:13px;height:12px;display:inline-block;background:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTMiIGhlaWdodD0iMTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTYuMzA5IDkuMjJMMi40MDkgMTJsMS40NC00LjU2N0wwIDQuNTgzbDQuNzg4LS4wNDJMNi4zMDggMCA3LjgzIDQuNTRsNC43ODkuMDQ0LTMuODUgMi44NDlMMTAuMjA5IDEyeiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+)}.photos{display:grid;grid-template-columns:repeat(2, 1fr);grid-gap:10px;grid-auto-rows:30vh}.thumb{position:relative;width:100%;overflow:hidden;position:relative;background:#000}.thumb .caption{position:absolute;width:100%;height:100%;top:0;left:0;background:rgba(100,100,100,0.5);color:#fff;opacity:0;transition:opacity 0.5s}.thumb .thumb-image{display:block;object-fit:cover;position:absolute;width:100%;height:100%}.photo-date{display:block;position:absolute;top:10px;left:10px;font-size:20px}.photo-caption{display:block;position:absolute;bottom:10px;left:10px;font-size:30px}.modal-content .photo-date,.modal-content .photo-caption{width:80%;margin-left:-40%;color:#fff;opacity:1;left:50%;text-align:center}@media (min-width: 768px){.modal-content .photo-date,.modal-content .photo-caption{width:600px;margin-left:-300px}}.thumb:hover div{opacity:1}.modal{opacity:0;visibility:hidden;position:fixed;top:0;right:0;bottom:0;left:0;text-align:left;background:rgba(0,0,0,0.8);transition:opacity .25s ease;z-index:99}.modal-content{width:100%;height:100%}.modal-photo{width:70%;max-height:80%;position:absolute;left:50%;top:10%;margin-left:-35%;object-fit:cover}.modal-state{display:none}.modal-state:checked+.modal{opacity:1;visibility:visible}.sidebar{padding-bottom:1em;border-bottom:1px #7a8288 solid}@media (min-width: 1024px){.sidebar{border-bottom:0;float:left;width:calc(330px - 1em)}}.sidebar h4,.sidebar h5{margin-top:1em;margin-bottom:1em;font-family:-apple-system,BlinkMacSystemFont,"Roboto","Segoe UI","Helvetica Neue","Lucida Grande",Arial,sans-serif}.author-avatar{display:block;width:10em;margin:auto;max-width:9em}.author-content{display:block;text-align:center;padding-left:15px;padding-right:25px;line-height:0}.author-content h4{font-size:1.563em}.author-content h5{text-align:inherit;color:#737c7f;font-size:1.25em;margin-top:-15px}.author-content h5:hover{text-decoration:underline;color:black}@media (min-width: 1024px){.author-content{text-align:unset;width:100%;padding-left:0;padding-right:0}}.icon{font-size:1.4em;color:#737c7f}.icon:hover{color:black}@media (min-width: 1024px){.sticky{position:-webkit-sticky;position:sticky;top:2em;height:calc(100%)}}@font-face{font-family:'fa';src:url("/assets/font/fa.eot?93019596");src:url("/assets/font/fa.eot?93019596#iefix") format("embedded-opentype"),url("/assets/font/fa.woff2?93019596") format("woff2"),url("/assets/font/fa.woff?93019596") format("woff"),url("/assets/font/fa.ttf?93019596") format("truetype"),url("/assets/font/fa.svg?93019596#fa") format("svg");font-weight:normal;font-style:normal}[class^="icon-"]:before,[class*=" icon-"]:before{font-family:"fa";font-style:normal;font-weight:normal;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:0.5em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-mail:before{content:'\e800'}.icon-github-circled:before{content:'\f09b'}.icon-li:before{content:'\f0e1'}div.highlighter-rouge,figure.highlight{position:relative;margin-bottom:1em;background:#263238;color:#eff;font-family:Monaco,Consolas,"Lucida Console",monospace;font-size:.75em;line-height:1.8;border-radius:4px}div.highlighter-rouge>pre,div.highlighter-rouge pre.highlight,figure.highlight>pre,figure.highlight pre.highlight{margin:0;padding:1em}.highlight table{margin-bottom:0;font-size:1em;border:0}.highlight table td{padding:0;width:calc(100% - 1em);border:0}.highlight table td.gutter,.highlight table td.rouge-gutter{padding-right:1em;width:1em;color:#b2ccd6;border-right:1px solid #b2ccd6;text-align:right}.highlight table td.code,.highlight table td.rouge-code{padding-left:1em}.highlight table pre{margin:0}.highlight pre{width:100%}.highlight .hll{background-color:#eff}.highlight .c{color:#b2ccd6}.highlight .err{color:#f07178}.highlight .k{color:#c792ea}.highlight .l{color:#f78c6c}.highlight .n{color:#eff}.highlight .o{color:#89ddff}.highlight .p{color:#eff}.highlight .cm{color:#b2ccd6}.highlight .cp{color:#b2ccd6}.highlight .c1{color:#b2ccd6}.highlight .cs{color:#b2ccd6}.highlight .gd{color:#f07178}.highlight .ge{font-style:italic}.highlight .gh{color:#eff;font-weight:bold}.highlight .gi{color:#c3e88d}.highlight .gp{color:#b2ccd6;font-weight:bold}.highlight .gs{font-weight:bold}.highlight .gu{color:#89ddff;font-weight:bold}.highlight .kc{color:#c792ea}.highlight .kd{color:#c792ea}.highlight .kn{color:#89ddff}.highlight .kp{color:#c792ea}.highlight .kr{color:#c792ea}.highlight .kt{color:#ffcb6b}.highlight .ld{color:#c3e88d}.highlight .m{color:#f78c6c}.highlight .s{color:#c3e88d}.highlight .na{color:#82aaff}.highlight .nb{color:#eff}.highlight .nc{color:#ffcb6b}.highlight .no{color:#f07178}.highlight .nd{color:#89ddff}.highlight .ni{color:#eff}.highlight .ne{color:#f07178}.highlight .nf{color:#82aaff}.highlight .nl{color:#eff}.highlight .nn{color:#ffcb6b}.highlight .nx{color:#82aaff}.highlight .py{color:#eff}.highlight .nt{color:#89ddff}.highlight .nv{color:#f07178}.highlight .ow{color:#89ddff}.highlight .w{color:#eff}.highlight .mf{color:#f78c6c}.highlight .mh{color:#f78c6c}.highlight .mi{color:#f78c6c}.highlight .mo{color:#f78c6c}.highlight .sb{color:#c3e88d}.highlight .sc{color:#eff}.highlight .sd{color:#b2ccd6}.highlight .s2{color:#c3e88d}.highlight .se{color:#f78c6c}.highlight .sh{color:#c3e88d}.highlight .si{color:#f78c6c}.highlight .sx{color:#c3e88d}.highlight .sr{color:#c3e88d}.highlight .s1{color:#c3e88d}.highlight .ss{color:#c3e88d}.highlight .bp{color:#eff}.highlight .vc{color:#f07178}.highlight .vg{color:#f07178}.highlight .vi{color:#f07178}.highlight .il{color:#f78c6c}.gist th,.gist td{border-bottom:0}</style></head><body><div class="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="https://schema.org/Person"> <img src="/assets/images/face.jpg" alt="Matt Arderne" class="author-avatar" itemprop="image"><div class="author-content"><h4 itemprop="name">Matt Arderne</h4><a href="/"><h5>Home</h5></a> <a href="/about/"><h5>About</h5></a> <a href="/books/"><h5>Books</h5></a> <a href="/photos/"><h5>Photos</h5></a> <a href="/training/"><h5>Training</h5></a> <a href="mailto:matt@pm.me"><i class="icon icon-mail"></i></a> <a href="https://www.linkedin.com/in/matthew-arderne" target="_blank"><i class="icon icon-li"></i></a> <a href="https://github.com/mattarderne" target="_blank"><i class="icon icon-github-circled"></i></a> <!--<h5 itemprop="name">London, UK</h5>--></div></div></div><div class="body"><article itemscope itemtype="https://schema.org/CreativeWork"><meta itemprop="headline" content="Modelling hydrological networks at massive scale"><meta itemprop="description" content="Ironically, a large part of my work at KTH’s Division of Energy Systems Analysis was modelling complex hydrological systems. I set out to create a model that would conduct massive scale hydrological modelling."><meta itemprop="datePublished" content="April 15, 2017"><header> <span class="page-date"><time datetime="2017-04-15T13:26:00+01:00">15 April 2017</time></span> <span class="taglist" itemprop="keywords"> <a href="/#inside" rel="tag">inside</a> </span><h1 class="page-title" itemprop="headline">Modelling hydrological networks at massive scale</h1></header><section class="page-content" itemprop="text"><p>Ironically, a large part of my work at KTH’s Division of <a href="https://www.kth.se/en/itm/inst/energiteknik/forskning/desa/welcome-to-the-unit-of-energy-systems-analysis-kth-desa-1.197296">Energy Systems Analysis</a> was modelling complex hydrological systems. Often, this was while modelling the ‘nexus’ between different systems, such as energy, water and climate – as opposed to treating these as separate fields of study.</p><p>A lot of this was done in <a href="https://www.weap21.org/index.asp?NewLang=EN">WEAP</a>, a hydrological modelling package courtesy of the <a href="https://www.sei.org/">Stockholm Environmental Institute</a>. This provided an easy user interface, and access to a variety of complex models and systems for things such as rainwater run-off and crop requirements. However, it isn’t easily scriptable, and is mostly suited to very localised systems.</p><p>So when my colleagues and I wanted to conduct a continent-scale assessment of mini-hydropower potential, we had to turn elsewhere. For the first version of this, I created a simple script to run down every river in a given network and calculate the elevation drop (head) between points to estimate hydropower potential. We applied this to the whole of Sub-Saharan Africa, using river networks from <a href="http://www.hydrosheds.org/">HydroSHEDS</a> and run-off data from the EU’s <a href="https://data.jrc.ec.europa.eu/collection/water">Joint Research Centre</a>.</p><p>Update: The paper we wrote on this has recently been published with the journal Energies: <a href="https://www.mdpi.com/1996-1073/11/11/3100">A Geospatial Assessment of Small-Scale Hydropower Potential in Sub-Saharan Africa</a>.</p><p>Later on, I decided to improve and generalise this simple model and came with an unwieldy bit of code called <a href="https://github.com/carderne/hydro-networks">hydro-networks</a>. Instead of just creating points all over the show, I set out to create a model that would:</p><ul><li>Conduct massive scale hydrological modelling</li><li>Calculate run-off and stream-flow using precipitation and land-use data</li><li>Model rivers in a network-aware manner</li><li>Allow point sources/drains such as farms and dams to be added procedurally</li></ul><p>At a rough estimate, I achieved about 3/4 of this, and realised run-off modelling is damn hard. What I did manage was still pretty fun, so I’m going to go over an example below, in the hopes that one day I’ll pick this up again and complete it.</p><h2 id="create-direction-aware-river-networks">Create direction-aware river networks</h2><p>The model uses the wonderful <a href="http://geopandas.org/">GeoPandas</a> library to read in the river network data from <a href="http://www.hydrosheds.org/">HydroSHEDS</a>. It is very happy crunching the data for the whole African continent, but to make this easier, I’ve clipped out a small river called Dieprivier just outside Cape Town(yes, they exist).</p><p><img src="/assets/images/2017/hydro1.jpg" alt="Dieprivier" /></p><p>If we zoom into a small section, we see the the model-generated layer (purple)matches pretty well with the painstakingly traced data (light blue) fromOpenStreetMap.</p><p><img src="/assets/images/2017/hydro2.jpg" alt="Section" /></p><p>The model then goes through a couple of steps to convert this GIS data into something we can use for modelling.</p><ol><li>Go through every river segment in the input data, and create for it a separate arc, which altogether form the network data structure.</li><li>As it does this, create another data structure called nodes that contains all of these points where arcs meet or terminate.</li><li>Then tell every arc which two nodes it is connected to, and tell each node which arcs it is connected to. This means if we know a node location, we know which arcs connect to it, and therefore which other nodes are connected, and so on.</li></ol><p>A small section of the resulting layers is shown below, with the nodes at the intersections of river arcs. The large green node knows which arcs are connected to it (also in green) and they in turn know about it.</p><p><img src="/assets/images/2017/hydro3.jpg" alt="Nodes" /></p><h2 id="giving-the-network-some-order">Giving the network some order</h2><p>This is all very well, but it’s still just a bunch of lines and dots. To make this network a lot easier to use, we must assign <a href="https://en.wikipedia.org/wiki/Stream_order">stream order</a> to the arcs – essentially indicating how many upstream branches they have. This is a useful proxy for how ‘big’ any part of a river is relative to the network, but also allows the model to easily orientate itself to what is up- and down-stream of any node.</p><p>There are two main approaches to this, the <a href="https://en.wikipedia.org/wiki/Strahler_number">Strahler number</a> and the Shreve number. For the Strahler number, the smallest tributaries are assigned an order of 1. These are then followed down, and when two 1’s join, they form a 2. If two streams with a different number join, it gets the higher of the two, i.e. 1+2=2. The Shreve number is similar, except the numbers always add, so 1+2=3! For this model, I used the Shreve number, as it ensures that a downstream section always has a higher number that the sections upstream of it.</p><p>To achieve this, I adapted the algorithm from <a href="https://doi.org/10.1111/j.1752-1688.2004.tb01057.x">this paper</a> (Gleyzer, et al., 2007), a beautiful but not very intuitive recursive function. Basically, it starts at the mouth of a given river (identified by a separate bit of code) and then follows recursively up the network until it reaches the mountain-top tributaries. Then it trickles back down to the mouth, adding up the stream orders as it goes.</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def shreve(arc_index, direction_node_id, network, nodes):
    up_stream_orders = []
    if len(nodes[direction_node_id]) == 5:
        network[arc_index][7] = 1
    else:
        for index, arc in enumerate(nodes[direction_node_id]):
            if index &gt;= 4:
                if network[arc][0] != arc_index:
                    if network[arc][5] != direction_node_id:
                        up_stream_orders.append(shreve(arc,
                            network[arc][5], network, nodes))
                    else:
                        up_stream_orders.append(shreve(arc,
                            network[arc][6], network, nodes))
        max_orders = heapq.nlargest(2, up_stream_orders)
        if len(max_orders) == 2:
            order = 0 + max_orders[0] + max_orders[1]
        else:
            order = 0 + max(up_stream_orders)

        network[arc_index][7] = order
    return network[arc_index][7]
</code></pre></div></div><p>Applied to the entire river network, it looks something like this.</p><p><img src="/assets/images/2017/hydro4.jpg" alt="Stream order" /></p><h2 id="adding-data-layers-and-doing-things">Adding data layers and doing things</h2><p>Now that we have the network set up and ordered, it’s time to do something with it! In addition to the run-off data mentioned further up, there are a few other important layers:</p><ul><li>Digital elevation model (DEM), normally from NASA’s <a href="https://www2.jpl.nasa.gov/srtm/">SRTM </a></li><li>Flow accumulation, which is derived from the DEM and also available at <a href="http://www.hydrosheds.org/">HydroSHEDS</a></li><li>Land cover, used for modelling run-off and available <a href="http://www.fao.org/land-water/land/land-governance/land-resources-planning-toolbox/category/details/en/c/1036355/">from the FAO</a></li><li>ETo, the reference evapo-transpiration for an area, also available from the FAO</li><li>Precipitation, from many sources, hopefully monthly, never easy to use</li></ul><p>For example, here’s our same river overlaid with the DEM elevation data.</p><p><img src="/assets/images/2017/hydro5.jpg" alt="DEM" /></p><p>Previously I used the laborious and buggy <a href="http://pro.arcgis.com/en/pro-app/arcpy/get-started/what-is-arcpy-.htm">ArcPy</a> t oextract all of this information in the network and nodes data structures, but now <a href="https://github.com/mapbox/rasterio">rasterio</a> makes this a walk in the park. It’s a straightforward library for reading raster GIS data and sampling and manipulating it, and takes only a few lines to load all of this new data.</p><h2 id="calculating-hydropower-potential">Calculating hydropower potential</h2><p>One thing that we can do with all of this data is replicate the hydropower estimates, from the paper we wrote, except now just for Dieprivier in Cape Town.Note that this is exclusively for <a href="https://en.wikipedia.org/wiki/Run-of-the-river_hydroelectricity">run-of-river</a> mini-hydropower. To estimate power output, we use the hydropower formula as follows:</p><ul><li>P = ηρgQH</li></ul><p>where P is the power output, η is the efficiency, ρ is the density of water,and g is acceleration due to gravity. Q is the flow-rate, and H is the head, or height difference available. These last two must be calculated for each point using the data described above.</p><p>The head is simple: we get the height for our chosen point, and then look a set distance up-stream and get the height there – the difference between these is the head. The flow-rate is more complicated. The global run-off data we have is provided in m/s, where we need m3/s. So we do the following:</p><ul><li>Q = runoff × catchment-area</li></ul><p>where catchment-area is the total area upstream of the selected point.Multiplying these together calculates the theoretical amount of water that should flow past this point.</p><p>Applying this to Dieprivier, the model creates a point every 500 metres and calculates the head over the preceding 500 metres. By filtering to only include those with at least 10 metres of head and more than 100 kW output, we get the following suggested point of 162 kW, with 12 metres of head and flow rate of 2.75 m3/s.</p><p><img src="/assets/images/2017/hydro6.jpg" alt="Hydropower" /></p><p>Note that this is an unchecked, un-calibrated example result, I’m not at all suggesting someone should build a mini-hydropower site there.</p><h2 id="going-further-with-rainfall-run-off-and-discharge">Going further with rainfall run-off and discharge</h2><p>The result above was calculated using the GSCD, which provides only a single value, with no monthly or yearly variations. This doesn’t provide much information about seasonal changes, nor allow for any calibrations with stream gauges, which will likely be on a daily or monthly basis.</p><p>To improve this, I extended the model to work with precipitation as an input instead, which is often available as monthly (or even daily data). For each node then, the model takes local precipitation, land cover and evapo-transpiration data and uses the <a href="http://www.weap21.org/webhelp/hydrology.htm">Simplified Coefficeint Method</a> to calculate local rainfall run-off. This is then carried downstream in the model, and when stream join,their flows are combined. At the same time, there are certain losses on each stream due to various causes.</p><p>Then every river section has a (potentially) more accurate discharge associated with it, which is now able to vary by month and day. So in the example above, we could specify not only the mean power output, but also show which months we expect to have lower and higher output.</p><p>The code for this is all with the model in the <a href="https://github.com/carderne/hydro-networks">GitHub rep</a>, but be aware – it takes a lot of fiddling and calibration to get useful numbers out, and precipitation and stream-gauge data often require a lot more data wrangling to make ready for the model.I was on the verge of setting up the model to calibrate against some measurements automatically, but that’ll have to be a project for another day.</p><h2 id="towards-a-generalised-model">Towards a generalised model</h2><p>From there, it’s not a huge step to add other point withdrawals (such as city water requirements or a farm) and use the model to make predictions about the system. For example, by including projected precipitation changes and increased population (and hence increased withdrawals) we could model whether there would be a water shortfall, and in which months this would be most severe.</p><p>As I said, the model isn’t quite there, but hopefully I’ll come back to it at some point.</p></section></article></div></div></body></html>
